confirmable_notification:
  alias: Notificação - Começou a chover
  description: Envia notificação confirmável quando começa a chover
  fields:
    alerta:
      description: true se houver janela ou porta aberta
      example: true
    repeticao:
      description: true se for lembrete
      example: true
    aberturas:
      description: Lista textual das aberturas abertas
      example: Janela quarto crianças, Porta sacada
  use_blueprint:
    path: homeassistant/confirmable_notification.yaml
    input:
      notify_device: fe214fad2e404924e2e37f9f48b69d0f
      title: "{% set a = alerta | default(false) %} {% set r = repeticao | default(false)
        %} {% if not r and a %} \U0001F6A8 Chuva começou — janela ou porta aberta
        {% elif not r %} \U0001F327️ Chuva começou {% elif r and a %} \U0001F6A8 Chuva
        em andamento — janela ou porta aberta {% else %} ⏱️ Chuva em andamento {%
        endif %}"
      message: '{% if repeticao | default(false) %} Lembrete às {{ now().strftime(''%H:%M'')
        }}. {% else %} Detectado em {{ now().strftime(''%d/%m/%Y'') }} às {{ now().strftime(''%H:%M'')
        }}. {% endif %}

        {% if alerta | default(false) %} ⚠️ Atenção: {{ aberturas if aberturas|length
        > 0 else ''há janela ou porta aberta'' }}. Vou continuar avisando a cada 5
        minutos enquanto estiver chovendo, até você confirmar. {% else %} ✅ Tudo fechado
        por enquanto. {% endif %}'
      confirm_text: Confirmar
      confirm_action:
      - target:
          entity_id: input_boolean.chuva_alerta_confirmado
        action: input_boolean.turn_on
        data: {}
notificacao_chuva_parou:
  alias: Notificação - Chuva parou
  description: Envia notificação confirmável quando a chuva parar
  fields:
    alerta:
      description: true se houver janela ou porta aberta
      example: true
    aberturas:
      description: Lista textual das aberturas abertas
      example: Janela quarto crianças, Porta sacada
  use_blueprint:
    path: homeassistant/confirmable_notification.yaml
    input:
      notify_device: fe214fad2e404924e2e37f9f48b69d0f
      title: "{% if alerta | default(false) %}\n  ⚠️ Chuva parou — janela ou porta
        aberta\n{% else %}\n  ☀️ Chuva parou\n{% endif %}"
      message: 'A chuva parou às {{ now().strftime(''%H:%M'') }}.

        {% if alerta | default(false) %} ⚠️ Ainda há {{ aberturas if aberturas|length
        > 0 else ''janela ou porta aberta'' }}. {% else %} ✅ Todas as janelas e portas
        estão fechadas. {% endif %}'
      confirm_text: Ok
      confirm_action:
      - target:
          entity_id: input_boolean.chuva_alerta_confirmado
        action: input_boolean.turn_off
        data: {}
      dismiss_action: []
